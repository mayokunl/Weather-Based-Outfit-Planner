{% extends "layout.html" %}
{% block content %}
<div class="container-card container-wide mt-xl">
  <div class="closet-header">
    <h1 class="heading-1">üß• My Closet</h1>
    {% if total_items %}
      <p class="text-muted">{{ total_items }} item{{ 's' if total_items != 1 else '' }} in your wardrobe</p>
    {% endif %}
  </div>
  
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  {% for category, message in messages %}
  <div class="alert alert-{{ category }} alert-dismissible fade show mb-lg" role="alert">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  {% endfor %}
  {% endif %}
  {% endwith %}
  
  {% if items_by_category %}
    {% for category, items in items_by_category.items() %}
      <div class="category-section mb-xl">
        <h2 class="category-title">
          {% if category == 'tops' %}üëï Tops
          {% elif category == 'bottoms' %}üëñ Bottoms  
          {% elif category == 'shoes' %}üëü Shoes
          {% elif category == 'accessories' %}üëú Accessories
          {% else %}üì¶ {{ category.title() }}
          {% endif %}
          <span class="item-count">({{ items|length }})</span>
        </h2>
        
        <div class="grid grid-3">
          {% for item in items %}
            <div class="closet-item-card">
              <div class="item-image-container">
                <img src="{{ item.image_url }}" class="item-image" alt="{{ item.title }}">
                <div class="item-overlay">
                  <form action="{{ url_for('closet.remove_from_closet', item_id=item.id) }}" method="POST" 
                        onsubmit="return confirm('Remove {{ item.title }} from your closet?')" class="remove-form">
                    <button type="submit" class="btn-remove" title="Remove from closet">
                      üóëÔ∏è
                    </button>
                  </form>
                </div>
              </div>
              
              <div class="item-details">
                <h5 class="item-title">{{ item.title }}</h5>
                <div class="item-meta">
                  {% if item.price %}
                    <span class="item-price">{{ item.price }}</span>
                  {% endif %}
                  {% if item.source %}
                    <span class="item-source">from {{ item.source }}</span>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="empty-closet">
      <div class="empty-icon">üëó</div>
      <h4 class="heading-2">Your closet is empty!</h4>
      <p class="text-muted mb-lg">Start planning trips and adding items to build your wardrobe.</p>
      <a class="btn btn-primary" href="{{ url_for('main.destination') }}">Plan a Trip</a>
    </div>
  {% endif %}
  
  <div class="button-group mt-xl">
    <a class="btn btn-secondary" href="{{ url_for('main.home') }}">üè† Back to Home</a>
  </div>
</div>

<style>
.closet-header {
  text-align: center;
  margin-bottom: 2rem;
}

.category-section {
  border: 1px solid #e1e5e9;
  border-radius: 12px;
  padding: 1.5rem;
  background: #fafbfc;
}

.category-title {
  color: #2c3e50;
  font-size: 1.5rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.item-count {
  font-size: 1rem;
  color: #7f8c8d;
  font-weight: normal;
}

.grid-3 {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 1.5rem;
}

.closet-item-card {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: transform 0.2s ease;
}

.closet-item-card:hover {
  transform: translateY(-2px);
}

.item-image-container {
  position: relative;
  height: 200px;
  overflow: hidden;
}

.item-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.item-overlay {
  position: absolute;
  top: 8px;
  right: 8px;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.closet-item-card:hover .item-overlay {
  opacity: 1;
}

.remove-form {
  margin: 0;
}

.btn-remove {
  background: rgba(255, 255, 255, 0.9);
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.2s ease;
}

.btn-remove:hover {
  background: #e74c3c;
  color: white;
}

.item-details {
  padding: 1rem;
}

.item-title {
  font-size: 1rem;
  margin-bottom: 0.5rem;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.item-meta {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.item-price {
  font-weight: bold;
  color: #27ae60;
}

.item-source {
  font-size: 0.85rem;
  color: #7f8c8d;
}

.empty-closet {
  text-align: center;
  padding: 3rem 1rem;
}

.empty-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}
</style>
{% endblock %}
